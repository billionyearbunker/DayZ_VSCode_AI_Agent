# DayZ Custom Mission Directory: Technical Architecture

## 1. Directory Overview & Pathing

- **Standard Path:** `/mpmissions/dayzOffline.chernarusplus/` (or `dayzOffline.enoch` for Livonia).
- **Role:** The "Software" running on the server "Hardware." It defines the specific game rules, player loadouts, economy settings, and weather for a specific map instance.
- **Selection:** The active mission folder is defined in the server root `serverDZ.cfg` via the `template="dayzOffline.chernarusplus";` parameter.

## 2. The Core Logic: init.c

This is the most critical script file in the mission folder. It acts as the constructor for the entire game session.

### A. Structure

It is an Enforce Script file containing a custom class extending `MissionServer`.

### B. Key Methods inside init.c

**`void main()`:** The entry point. It runs once when the server initializes.
- **Functions:** Initializes Hive (database connection), sets weather volatility, and calls `GetGame().GetUIManager()`.

**`override PlayerBase CreateCharacter(...)`:**
- **Purpose:** Intercepts the player connection event.
- **Usage:** Allows custom logic to dictate which model a player spawns as (e.g., forcing a specific gender or skin).

**`override void StartingEquipSetup(...)`:**
- **Purpose:** Defines the fresh spawn loadout.
- **Logic:** Uses `player.GetInventory().CreateInInventory("ItemName")` to populate the character.
- **Oddity:** If you delete the Tshirt creation lines here, players spawn naked (topless).

**`override void OnPreloadFinished(...)`:**
- **Purpose:** Runs immediately after the mission has finished loading assets. Often used for initializing modded handlers.

## 3. Economy Configuration: cfgeconomycore.xml

- **Role:** The "Loader" or "Manifest" file for the Central Economy (CLE).
- **Function:** It tells the server which XML files to load for the economy.

### Crucial Feature: Custom File Injection

Instead of editing the default `types.xml`, you can define custom files here:

```xml
<ce folder="db">
    <file name="types.xml" type="types" />
    <file name="my_custom_mod_types.xml" type="types" />
</ce>
```

This allows for modular server management, keeping mod types separate from vanilla types.

## 4. The Database Sub-Directory (/db/)

Contains the specific economy logic files referenced by `cfgeconomycore.xml`.

**events.xml:**
- Controls the "spawners" for dynamic events (Helis, Police Wrecks, Animal herds).
- It does not define the loot at these events, only the location and frequency of the event vehicle/object itself.

**globals.xml:** Server-wide global variables.
- **LootProxyPlacement:** (1/0) Toggles loot spawning inside furniture/containers.
- **RespawnAttempt:** (Int) How many times the engine tries to place an item before giving up.
- **TimeHoarding:** (Int) Multiplier for how long items stay in tents/storage.

**messages.xml:**
- Controls server shut down messages (text and delay).

## 5. Environment & Hazards (/env/ & JSONs)

Modern DayZ versions rely heavily on JSON configuration for environmental hazards.

**cfgEffectArea.json:**
- Defines the Static and Dynamic Gas Zones (Contaminated Areas).
- **Structure:** Contains `Areas` (Array). Each area defines `TriggerType` (Gas), `Data` (Position, Radius), and `PlayerData` (Gas Suit Name).

**cfgGameplay.json (Optional but powerful):**
- **Location:** Often placed in root or custom folder, but overrides mission rules.
- **Capabilities:** Disabling stamina, removing map markers, changing hit indication, disabling personal light.
- **Significance:** Allows changing core gameplay mechanics without writing a `.pbo` mod.

**cfgweather.xml:**
- Controls the probability of rain, fog, and overcast skies.
- **Oddity:** DayZ weather is volatile. If you want a "Sunny 24/7" server, you must edit the `<limits>` to prevent rain/clouds from reaching the threshold that triggers the visual effect.

## 6. Persistence Storage: storage_1/

- **Generation:** This folder is automatically generated by the server upon first launch.

**Contents:**
- **players.db:** SQLite database (or binary format) containing player positions, health, and inventory.
- **data/:** Binary blobs representing the state of vehicles, tents, and persistent objects on the map.

**Wipe Logic:**
- To "Wipe" a server, you delete this folder. The server will regenerate it fresh using the logic from `init.c` and `/db/` on the next restart.

## 7. Operational Oddities & Constraints

**Compilation Locking:**
- `init.c` and the mission scripts are compiled at server start.
- You cannot edit `init.c` while the server is running and expect changes to take effect. A restart is mandatory.

**Map Group Position (map_grouppos.xml):**
- This file is massive and usually located in the mission folder (or referenced).
- It contains the coordinates of every single building on the map and tags them (e.g., "Land_Barracks" is tagged as "Military").
- **Dependency:** The `types.xml` file relies entirely on this. If `types.xml` says "Spawn M4 in Military," the engine looks at `map_grouppos.xml` to find coordinates tagged "Military."

**Class Names:**
- In `init.c`, standard C++ conventions apply, but the engine uses specific proprietary classes (`MissionServer`, `PlayerBase`, `EntityAI`).
- You cannot import standard C++ libraries; you are restricted to the Enforce Script API.
